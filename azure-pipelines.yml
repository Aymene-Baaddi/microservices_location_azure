trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  dockerRegistryServiceConnection: 'mywebapp'
  containerRegistry: 'mywebapp.azurecr.io'
  dockerComposeFile: 'docker-compose.yml'

steps:
- task: DockerCompose@0
  displayName: 'Build Docker Compose Images'
  inputs:
    action: 'Build services'
    azureSubscription: 'az-aymene'
    dockerComposeFile: '$(dockerComposeFile)'
    qualifyImageNames: true
    additionalImageTags: |
      $(Build.BuildId)
      latest
    containerregistry: '$(dockerRegistryServiceConnection:)'

- task: DockerCompose@0
  displayName: 'Push Docker Compose Images'
  inputs:
    action: 'Push services'
    dockerComposeFile: '$(dockerComposeFile)'
    azureSubscription: 'az-aymene'
    qualifyImageNames: true
    additionalImageTags: |
      $(Build.BuildId)
      latest
    containerregistry: '$(dockerRegistryServiceConnection:)'
